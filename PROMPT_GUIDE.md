# 做菜咨询系统 Prompt 指南

## 📋 概述

本文档包含了做菜咨询指导系统的完整prompt配置，用于指导AI助手提供专业的做菜建议。

## 🎯 系统目标

- 提供简洁、自然且非常详细的做菜指导
- 像朋友一样和用户交流
- 每个步骤都要具体明确，包含动作、火候、时间、状态
- 保持对话的流畅性和互动性
- 生成结构化的JSON响应

## 📁 文件说明

### 1. `cooking_prompt.txt`
基础的Jinja2模板prompt，包含变量占位符。

### 2. `cooking_config.json`
完整的系统配置文件，包含AI配置和备用响应信息。

### 3. `prompt_example.py`
prompt使用示例和演示代码。

## 🔄 系统功能

### 详细对话模式
系统采用简洁自然且详细的对话模式，提供：
- 初次回应：简单询问用户需求
- 菜品确认：问一个具体问题
- 食材准备：分组列举食材，每次只问2-3种，按重要性排序
- 食材记忆：严格跟踪已确认的食材，避免重复询问
- 需求一致性：严格保持用户最初需求，不得偏离
- 步骤指导：每个步骤都非常详细，包含动作、火候、时间、状态，每次只输出一个步骤
- 问题解决：快速提供替代方案
- 互动友好：适时询问用户情况

### 回复特点
- 每次只回复1-2句话，像朋友聊天
- 避免长篇大论，保持对话流畅
- 用口语化表达，避免过于正式
- 循序渐进，一次只处理一个问题
- 步骤指导要非常详细，包含具体动作、时间、状态描述，每次只输出一个步骤
- 食材分组列举，避免信息过载，提高记忆效果
- 严格记忆已确认的食材，避免重复询问
- 严格保持用户需求一致性，不得偏离原始需求

## 📝 Prompt 模板变量

### 必需变量
- `{{conversation_history}}`: 对话历史

### 条件变量
- `{{extracted_info}}`: 已收集的信息摘要

## 🎨 响应格式

### JSON 结构
```json
{
    "回复": "简洁自然的1-2句话回复",
    "提取信息": "从用户问题中提取的关键信息",
    "当前状态": "当前指导阶段（初次回应/菜品确认/食材准备/步骤指导/问题解决/结束关怀）"
}
```

### 示例响应
```json
{
    "回复": "番茄炒蛋很经典呢！你喜欢甜口还是咸口？",
    "提取信息": "用户想学番茄炒蛋",
    "当前状态": "菜品确认"
}
```

### 详细步骤指导示例
```json
{
    "回复": "第一步：把鸡蛋打散，用筷子顺时针搅拌30下，直到蛋液均匀没有蛋清块。这一步你做好了吗？",
    "提取信息": "用户开始步骤指导",
    "当前状态": "步骤指导"
}
```

**重要：每次只输出一个步骤，不要一次输出多个步骤**

### 食材分组列举示例
```json
{
    "回复": "先准备主要食材：五花肉和葱姜蒜，家里都有吗？",
    "提取信息": "用户开始食材准备",
    "当前状态": "食材准备"
}
```

### 食材记忆管理示例
```json
{
    "回复": "好的，我记得你有普通面粉和巧克力块。现在需要鸡蛋和牛奶，家里有吗？",
    "提取信息": "用户确认部分食材，继续询问其他食材",
    "当前状态": "食材准备"
}
```

### 需求一致性管理示例
```json
{
    "回复": "好的，我们继续做咸辣口味的饼干。现在需要盐和辣椒粉，家里有吗？",
    "提取信息": "用户确认需求，继续咸辣口味指导",
    "当前状态": "食材准备"
}
```

### 纠正偏离示例
```json
{
    "回复": "抱歉，我们继续做咸辣口味的饼干。现在加入盐和辣椒粉调味，这一步你做好了吗？",
    "提取信息": "纠正偏离，回到用户原始需求",
    "当前状态": "步骤指导"
}
```

## ⚙️ AI 配置

### 火山引擎豆包API配置
```json
{
    "model": "doubao-1.5-pro-32k-250115",
    "max_tokens": 2000,
    "temperature": 0.7,
    "stream": false
}
```

### 系统角色设定
```
你是一个专业的做菜指导助手，具有丰富的烹饪经验和专业知识。
请按照分阶段的方式收集用户信息，并提供个性化的做菜建议。
请严格按照JSON格式输出，包含阶段性回复和提取的信息。
```

## 🔧 使用方法

### 1. 直接使用模板
```python
import jinja2

template = jinja2.Template(open('cooking_prompt.txt').read())
prompt = template.render(
    start=1,
    all_information_key=['食材准备', '厨具设备', '烹饪经验', '时间安排', '特殊需求'],
    conversation_history="",
    extracted_info=""
)
```

### 2. 使用配置文件
```python
import json

config = json.load(open('cooking_config.json'))
phases = config['consultation_phases']
ai_config = config['ai_config']
```

### 3. 集成到API调用
```python
def call_ai_api(prompt, query):
    headers = {
        "Content-Type": "application/json",
        "Authorization": f"Bearer {API_KEY}"
    }
    
    data = {
        "model": "doubao-1.5-pro-32k-250115",
        "messages": [
            {"role": "system", "content": prompt},
            {"role": "user", "content": query}
        ],
        "max_tokens": 2000,
        "temperature": 0.7
    }
    
    response = requests.post(API_ENDPOINT, headers=headers, json=data)
    return response.json()
```

## 🚨 注意事项

1. **JSON格式**: 确保AI响应严格按照JSON格式输出
2. **错误处理**: 当API调用失败时，使用备用响应
3. **阶段顺序**: 严格按照优先级顺序收集信息
4. **信息提取**: 从用户回答中提取相关信息并分类存储
5. **个性化**: 根据用户的具体情况提供定制化建议

## 📈 优化建议

1. **关键词扩展**: 根据实际使用情况扩展关键词库
2. **问题优化**: 根据用户反馈优化问题设计
3. **响应模板**: 为常见菜品创建专门的响应模板
4. **多语言支持**: 扩展支持多语言prompt
5. **上下文增强**: 增加更多上下文信息以提高响应质量

## 🔗 相关文件

- `cooking_server.py`: 服务端实现
- `cooking_client.py`: 客户端实现
- `cooking_main.py`: 主程序
- `requirements.txt`: 依赖包列表
- `README.md`: 项目说明文档 